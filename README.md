# Dota2 Custom Game Rating API

### Описание
Простое API для системы рейтинга матчей 1x1 в кастомной карте Dota2.

### API Доступ
API доступен по адресу:  
`http://localhost:3000/api/v1`  
(Порт задаётся в настройках API в `config.json`)

### Эвенты API

#### **1. game_end**
Отправляется при завершении игры для определения победителя и проигравшего.  

**Обязательные параметры запроса:**
- `action` — указывается как `game_end`
- `data` — объект с информацией о завершении матча:
  ```json
  {
    "winner_id": <ID победителя>,
    "loser_id": <ID проигравшего>,
    "gameData": <объект с дополнительными данными>
  }
  ```
  Поле `gameData` может содержать данные, возвращаемые Dota 2 после матча (например, для статистики).  

**Примечание:**  
Эвент отсылается от имени сервера **один раз**.

---

#### **2. get_board**
Позволяет получить информацию о лидерборде (топ-10 игроков).  

**Обязательные параметры запроса:**
- `action` — указывается как `get_board`
- `data` — объект, содержащий:
  ```json
  {
    "winner_id": <ID победителя>,
    "loser_id": <ID проигравшего>,
    "gameData": {}
  }
  ```
  Поле `gameData` можно оставить пустым или заполнить произвольными данными.  

**Примечание:**  
Эвент можно отправлять от имени любого клиента. Количество игроков в лидерборде можно настроить в `config.json`.

---

#### **3. Проверка доступности (для Uptime Kuma)**
Эндпоинт для проверки доступности API и базы данных.  

**URL:**  
`http://localhost:3000/api/check`  

**Описание:**  
Эндпоинт запрашивает `SteamID` первого игрока в базе данных:  
- Возвращает `True`, если игрок найден.  
- Возвращает `False`, если игрок не найден или база недоступна.

---

### Пример использования
- Завершение игры:
  ```bash
  curl -X POST http://localhost:3000/api/v1 \
  -H "Content-Type: application/json" \
  -d '{"action": "game_end", "data": {"winner_id": 123456, "loser_id": 987654, "gameData": {"stats": "example"}}, "match_id": 1351564, "gametime": 1000, "version": "rating_1", "key": "API_KEY"}'
  ```
- Получение лидерборда:
  ```bash
  curl -X POST http://localhost:3000/api/v1 \
  -H "Content-Type: application/json" \
  -d '{"action": "get_board", "data": {"winner_id": 0, "loser_id": 0, "gameData": {}}, "match_id": 0, "gametime": 0, "version": "rating_1", "key": "API_KEY"}'
  ```
- Проверка доступности:
  ```bash
  curl http://localhost:3000/api/check
  ```

### Настройка
Все параметры API можно настроить в файле `config.json`.
